<ion-menu contentId="main-content">
  <ion-header>
    <ion-toolbar>
      <ion-title>Pokemon App</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <div class="menu-container">
      <ion-item routerLink="/home" routerDirection="root">
        <ion-icon slot="start" name="home-outline"></ion-icon>
        <ion-label>Home</ion-label>
      </ion-item>

      <ion-item routerLink="/profile" routerDirection="root">
        <ion-icon slot="start" name="person-outline"></ion-icon>
        <ion-label>Profile</ion-label>
      </ion-item>

      <ion-item routerLink="/favorite" routerDirection="root">
        <ion-icon slot="start" name="star-outline"></ion-icon>
        <ion-label>Favorite</ion-label>
      </ion-item>
    </div>
  </ion-content>
</ion-menu>

<div class="ion-page" id="main-content">
  <ion-header [translucent]="true">
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-menu-button></ion-menu-button>
      </ion-buttons>
      <ion-title class="Title"> Pokemon App </ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-content [fullscreen]="true">
    <ion-header collapse="condense">
      <ion-toolbar>
        <ion-title size="large">Pokemon App</ion-title>
      </ion-toolbar>
    </ion-header>

    <div id="container">
      <div class="records">
        <ion-item>
          <ion-input
            [(ngModel)]="search"
            type="text"
            (ionChange)="handleChangeSearch($event.detail.value!)"
            placeholder="Enter pokemon name"
          ></ion-input>
          <ion-button (click)="handleSearchPokemon()">Search</ion-button>
        </ion-item>
        <ion-item>
          <ion-select
            label="Filter by Type"
            [(ngModel)]="selectedType"
            (ionChange)="onTypeChange($event.target.value)"
          >
            <ion-select-option value="all">All</ion-select-option>
            <ion-select-option *ngFor="let type of allTypes" [value]="type">
              {{ type.charAt(0).toUpperCase() + type.substr(1) }}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </div>
      <div class="grid-container" *ngIf="pokemons || filteredPokemons">
        <ion-card
          *ngFor="let pokemon of selectedType === 'all' ? pokemons : filteredPokemons"
        >
          <div
            class="header-container"
            (click)="openModal(pokemon)"
          >
            <div class="header-rank"># {{ pokemon.id }}</div>
            <div class="header-image-container">
              <img
                *ngIf="pokemon && pokemon.image"
                class="header-image"
                alt="{{ pokemon.name }}"
                [src]="pokemon.image"
              />
              <div
                class="header-image-default-container"
                *ngIf="pokemon && !pokemon.image"
              >
                <img
                  class="header-image-default"
                  alt="{{ pokemon.name }}"
                  src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.pngplay.com%2Fwp-content%2Fuploads%2F5%2FQuestion-Mark-Symbol-PNG-Photo-Image.png&f=1&nofb=1&ipt=ef39b7947117870b5b1f4fe9c055778c66e6e09bf6b797a43047021ea5ff2325&ipo=images"
                />
              </div>
            </div>
          </div>
          <ion-card-header>
            <div class="title">
              <ion-card-title>
                {{pokemon.name.charAt(0).toUpperCase() +
                pokemon.name.substr(1)}}
              </ion-card-title>
              <ng-icon
                [name]="pokemon.isFavorite ? 'ionStarSharp' : 'ionStarOutline'"
                size="20px"
                [style.color]="pokemon.isFavorite ? 'yellow' : 'inherit'"
                (click)="toggleFavorite(pokemon)"
              />
            </div>
            <ion-card-subtitle>
              <ion-badge
                *ngFor="let type of pokemon.types.split(' ')"
                [ngClass]="getTypeClass(type)"
              >
                {{ type }}
              </ion-badge>
            </ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
            This Pokémon is {{ pokemon.weight }} kg and {{ pokemon.height }} cm
            tall.
          </ion-card-content>
        </ion-card>
      </div>
      <div *ngIf="pokemons.length <= 0 && filteredPokemons.length <= 0">
        <h1 class="error-message">No Pokémon Found!</h1>
      </div>

      <ion-modal>
        <ng-template>
          <ion-header>
            <ion-toolbar>
              <ion-title
                >{{ selectedPokemon?.name.charAt(0).toUpperCase() +
                selectedPokemon?.name.substr(1) || 'Pokemon' }}</ion-title
              >
              <ion-buttons slot="end">
                <ion-button (click)="dismissModal()">Close</ion-button>
              </ion-buttons>
            </ion-toolbar>
          </ion-header>
          <ion-content class="ion-padding">
            <div *ngIf="selectedPokemon" class="stats-container">
              <div class="stats-header-container">
                <div class="stats-rank"># {{selectedPokemon.id}}</div>
                <img
                  class="pokemon-image"
                  [alt]="selectedPokemon.name"
                  [src]="selectedPokemon.image || 'https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.pngplay.com%2Fwp-content%2Fuploads%2F5%2FQuestion-Mark-Symbol-PNG-Photo-Image.png&f=1&nofb=1&ipt=ef39b7947117870b5b1f4fe9c055778c66e6e09bf6b797a43047021ea5ff2325&ipo=images'"
                />
                <div class="stats-rank-right">
                  <ng-icon
                    [name]="selectedPokemon.isFavorite ? 'ionStarSharp' : 'ionStarOutline'"
                    size="20px"
                    [style.color]="selectedPokemon.isFavorite ? 'yellow' : 'white'"
                    (click)="toggleFavorite(selectedPokemon)"
                  />
                </div>
              </div>
              <h1>
                {{selectedPokemon?.name.charAt(0).toUpperCase() +
                selectedPokemon?.name.substr(1)}}
              </h1>
              <div class="stats-details">
                <div class="stats-number">
                  HP
                  <progress [value]="selectedPokemon.hp" max="100"></progress>
                </div>
                <div class="stats-number">
                  Attack
                  <progress
                    [value]="selectedPokemon.attack"
                    max="100"
                  ></progress>
                </div>
                <div class="stats-number">
                  Defense
                  <progress
                    [value]="selectedPokemon.defense"
                    max="100"
                  ></progress>
                </div>
                <div class="stats-number">
                  Special Attack
                  <progress
                    [value]="selectedPokemon.specialattack"
                    max="100"
                  ></progress>
                </div>
                <div class="stats-number">
                  Special Defense
                  <progress
                    [value]="selectedPokemon.specialdefense"
                    max="100"
                  ></progress>
                </div>
                <div class="stats-number">
                  Speed
                  <progress
                    [value]="selectedPokemon.speed"
                    max="100"
                  ></progress>
                </div>
              </div>
            </div>
          </ion-content>
        </ng-template>
      </ion-modal>
      <ion-infinite-scroll
        threshold="100px"
        (ionInfinite)="loadMore($event)"
        *ngIf="selectedType === 'all'"
      >
        <ion-infinite-scroll-content
          loadingSpinner="bubbles"
          loadingText="Loading more Pokémon..."
        >
        </ion-infinite-scroll-content>
      </ion-infinite-scroll>
    </div>
  </ion-content>
</div>
